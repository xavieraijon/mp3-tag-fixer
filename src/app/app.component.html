<!-- Main Container with Gradient Background -->
<div class="min-h-screen bg-gradient-to-br from-indigo-100 via-purple-50 to-pink-100 font-sans p-6 md:p-10">

  <!-- Global Snackbar -->
  @if (globalMessage()) {
    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 animate-slide-up">
      <div class="flex items-center gap-3 px-5 py-3 rounded-xl shadow-2xl border backdrop-blur-xl"
           [class]="globalMessage()!.type === 'success' ? 'bg-green-500/90 border-green-400 text-white' :
                    globalMessage()!.type === 'error' ? 'bg-red-500/90 border-red-400 text-white' :
                    'bg-slate-800/90 border-slate-700 text-white'">
        <!-- Icon -->
        @if (globalMessage()!.type === 'success') {
          <lucide-icon name="circle-check" class="w-5 h-5 flex-shrink-0"></lucide-icon>
        } @else if (globalMessage()!.type === 'error') {
          <lucide-icon name="circle-alert" class="w-5 h-5 flex-shrink-0"></lucide-icon>
        } @else {
          <lucide-icon name="loader-circle" class="w-5 h-5 flex-shrink-0 animate-spin"></lucide-icon>
        }
        <!-- Message -->
        <span class="font-medium text-sm">{{ globalMessage()!.text }}</span>
        <!-- Dismiss -->
        <button (click)="dismissMessage()" class="ml-2 hover:opacity-70 transition-opacity">
          <lucide-icon name="x" class="w-4 h-4"></lucide-icon>
        </button>
      </div>
    </div>
  }

  <!-- Decorative Blobs -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute -top-40 -right-40 w-96 h-96 bg-purple-300/30 rounded-full blur-3xl"></div>
    <div class="absolute top-1/2 -left-40 w-80 h-80 bg-blue-300/30 rounded-full blur-3xl"></div>
    <div class="absolute -bottom-40 right-1/3 w-96 h-96 bg-pink-300/30 rounded-full blur-3xl"></div>
  </div>

  <!-- Edit Modal -->
  @if (editingItem()) {
      <app-tag-editor
        [tags]="editForm()"
        [coverImageUrl]="editingItem()!.coverImageUrl"
        (save)="saveEditor($event)"
        (cancel)="closeEditor()">
      </app-tag-editor>
  }

  <div class="relative z-10 max-w-5xl mx-auto">
    <!-- Header -->
    <header class="text-center mb-10">
      <div class="inline-flex items-center justify-center p-4 backdrop-blur-xl bg-white/30 rounded-2xl mb-5 shadow-xl border border-white/40">
        <lucide-icon name="music" class="text-indigo-600 w-10 h-10"></lucide-icon>
      </div>
      <h1 class="text-4xl md:text-5xl font-extrabold text-slate-800 mb-2 tracking-tight">
        MP3 Tag Fixer
      </h1>
      <p class="text-slate-500 font-medium">
        Auto-magic metadata with Discogs
      </p>
    </header>

    <!-- Drop Zone -->
    <app-dropzone
        (filesDropped)="addFiles($event)"
        class="block mb-8">
    </app-dropzone>

    <!-- App Content -->
    @if (files().length > 0) {

      <app-filter-bar
        [filterText]="filterQuery()"
        (filterTextChange)="filterQuery.set($event)"
        (processVisible)="autoProcessAll()"
        (analyzeBpmAll)="analyzeAllBpm()"
        (downloadAll)="downloadAllZip()"
        (clearList)="clearList()">
      </app-filter-bar>

      <div class="space-y-4">
        @for (item of filteredFiles(); track item.originalName; let i = $index) {
           <app-file-card
             [item]="item"
             (search)="search(item)"
             (edit)="openEditor(item)"
             (remove)="removeFile(i)"
             (download)="downloadFile(item)"
             (selectRelease)="selectRelease(item, $event)"
             (selectTrack)="selectTrack(item, $event)"
             (detectBpm)="detectBpm(item)"
             (artistChange)="updateArtist(item, $event)"
             (titleChange)="updateTitle(item, $event)">
           </app-file-card>
        }
      </div>

    }
  </div>
</div>
