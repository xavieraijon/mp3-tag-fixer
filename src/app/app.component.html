<!-- Main Container -->
<div class="min-h-screen relative font-sans">
  <!-- Background -->
  <div class="fixed inset-0 z-0 bg-gradient-to-br from-slate-100 via-slate-50 to-indigo-50 dark:from-slate-950 dark:via-slate-900 dark:to-indigo-950">
    <img
      src="/assets/music-background.png"
      alt=""
      class="w-full h-full object-cover opacity-30 dark:opacity-10"
    />
  </div>

  <!-- Global Snackbar -->
  <app-snackbar></app-snackbar>

  <!-- Edit Modal -->
  @if (editingItem()) {
    <app-tag-editor
      [tags]="editForm()"
      [coverImageUrl]="editingItem()!.coverImageUrl"
      (save)="saveEditor($event)"
      (cancelEdit)="closeEditor()"
    >
    </app-tag-editor>
  }

  <!-- Content -->
  <div class="relative z-10">
    <!-- Header -->
    <header
      class="sticky top-0 z-50 backdrop-blur-xl bg-white/70 dark:bg-slate-900/80 border-b border-slate-200/50 dark:border-slate-800/50 shadow-sm px-6 py-3"
    >
      <div class="max-w-7xl mx-auto flex items-center justify-between">
        <!-- Left: Logo + Title -->
        <div class="flex items-center gap-3">
          <div class="h-12 w-12 flex items-center justify-center">
            <img
              src="/assets/logo.png"
              alt="MP3 Tag Fixer"
              class="w-full h-full object-contain filter drop-shadow-md"
            />
          </div>
          <div>
            <h1 class="text-lg font-bold text-slate-800 dark:text-slate-100 tracking-tight">
              MP3 Tag Fixer
            </h1>
            <p class="text-slate-500 dark:text-slate-400 text-xs">
              Auto-magic metadata with Discogs
            </p>
          </div>
        </div>

        <!-- Right: Theme Toggle -->
        <div class="flex items-center gap-3">
          <app-theme-toggle></app-theme-toggle>
        </div>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto px-6 py-6">
      <!-- Drop Zone -->
      <app-dropzone (filesDropped)="addFiles($event)" class="block mb-6"></app-dropzone>

      <!-- Filter Bar -->
      <app-filter-bar
        [filterText]="filterQuery"
        (filterTextChange)="filterQuery = $event"
        [aiEnabled]="aiService.enabled()"
        (aiEnabledChange)="aiService.setEnabled($event)"
        [debugMode]="store.debugMode()"
        (debugModeChange)="store.setDebugMode($event)"
        [hasFiles]="files().length > 0"
        (processVisible)="autoProcessAll()"
        (analyzeBpmAll)="analyzeAllBpm()"
        (downloadAll)="downloadAllZip()"
        (clearList)="clearList()"
        (openYoutubeModal)="showYoutubeModal.set(true)"
        class="block mb-6"
      >
      </app-filter-bar>

      <!-- File Cards List -->
      @if (files().length > 0) {
        <div class="space-y-3">
          @for (item of filteredFiles(); track item.originalName; let i = $index) {
            <app-file-card
              [item]="item"
              [aiEnabled]="aiService.enabled()"
              (requestSearch)="search(item)"
              (edit)="openEditor(item)"
              (remove)="removeFile(i)"
              (download)="downloadFile(item)"
              (selectRelease)="selectRelease(item, $event)"
              (selectTrack)="selectTrack(item, $event)"
              (detectBpm)="detectBpm(item)"
              (artistChange)="updateArtist(item, $event)"
              (titleChange)="updateTitle(item, $event)"
              (retryWithAi)="enableAiAndRetry(item)"
            >
            </app-file-card>
          }
        </div>
      } @else {
        <!-- Empty State -->
        <div
          class="text-center py-16 px-8 rounded-2xl border-2 border-dashed border-slate-200 dark:border-slate-700 bg-white/30 dark:bg-slate-800/30"
        >
          <lucide-icon
            name="music"
            class="w-16 h-16 mx-auto text-slate-300 dark:text-slate-600 mb-4"
          ></lucide-icon>
          <h3 class="text-lg font-semibold text-slate-600 dark:text-slate-400 mb-2">
            No files yet
          </h3>
          <p class="text-slate-500 dark:text-slate-500 text-sm">
            Drop MP3 files above or click to browse
          </p>
        </div>
      }
    </main>
  </div>

  <!-- YouTube Modal -->
  @if (showYoutubeModal()) {
    <app-youtube-modal
      (closed)="showYoutubeModal.set(false)"
      (downloaded)="handleYoutubeDownload($event)"
    >
    </app-youtube-modal>
  }

  <!-- Auth Modals -->
  @if (showLoginModal()) {
    <app-login (closeModal)="showLoginModal.set(false)" (switchToRegister)="switchToRegister()">
    </app-login>
  }

  @if (showRegisterModal()) {
    <app-register (closeModal)="showRegisterModal.set(false)" (switchToLogin)="switchToLogin()">
    </app-register>
  }
</div>
